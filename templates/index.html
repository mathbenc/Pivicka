<!doctype html>
<html lang="sl">

<head>
  <!-- CSS -->
  <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
  <!-- Bootstrap core CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Design Bootstrap -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.14.1/css/mdb.min.css" rel="stylesheet">
  <!-- MDBootstrap Datatables  -->
  <link href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">

  <!-- Primary Meta Tags -->
  <title>Pivička</title>
  <meta name="title" content="Pivička">
  <meta name="description" content="Koronavirus po svetu v številkah.">
  <meta name="keywords" content="corona,coronavirus,koronavirus,korona,virus,covid-19,pivicka,sars-cov-2">
  <meta name="author" content="M4thB3nc">
  <meta http-equiv="content-language" content="sl-sl">
  <meta charset="UTF-8">

  <!-- Web App Tags -->
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="application-name" content="Pivička">
  <meta name="apple-mobile-web-app-title" content="Pivička">
  <meta name="theme-color" content="#2E2E2E">
  <meta name="msapplication-navbutton-color" content="#2E2E2E">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="msapplication-starturl" content="/">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no">
  <link rel="icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='images/icon-512x512.png') }}">
  <link rel="apple-touch-icon" type="image/png" sizes="512x512" href="{{ url_for('static', filename='images/icon-512x512.png') }}">

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://pivicka.eu/">
  <meta property="og:title" content="Pivička">
  <meta property="og:description" content="Koronavirus po svetu v številkah.">
  <meta property="og:image" content="https://pivicka.eu/static/images/PivickaThumbnail.png">

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://pivicka.eu/">
  <meta property="twitter:title" content="Pivička">
  <meta property="twitter:description" content="Koronavirus po svetu v številkah.">
  <meta property="twitter:image" content="https://pivicka.eu/static/images/PivickaThumbnail.png">
</head>

<body>
  <div class="wrapper">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark elegant-color">
      
      <!-- Navbar brand -->
      <a class="navbar-brand" href="#" onClick="window.location.reload();">
        <img src="/static/images/beer_emoji.png" width="30" height="30" class="d-inline-block align-top" alt="pivicka">&nbsp
        <b>Na zdrav</b>(ljen)<b>je!</b>
      </a>

      <!-- Collapse button -->
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Collapsible content -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <form class="form-inline ml-auto" id="searchContainer">
          <div class="md-form my-0 active-pink active-pink-2">
            <input class="form-control mr-sm-2" type="text" aria-label="Išči državo" id="search" placeholder="Išči državo">
          </div>
        </form>
      </div>

    </nav>

    <!-- Tabela -->
    <div class="table-responsive" id="mainDiv">
      <table id="dataTable" class="table table-hover" style="margin-bottom: 0px !important;"></table>
    </div>

    <!-- Modal -->
    <div class="modal fade bottom" id="countryDetailsModal" tabindex="-1" role="dialog" aria-labelledby="countryDetailsModal" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable modal-full-height modal-bottom modal-notify modal-warning" role="document">
        
        <div class="modal-content">
          <div class="modal-header" id="countryDetailsModalHeader">
            <p class="heading lead modal-title w-100"><b id="countryDetailsModalTitle"></b></p>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true" class="white-text">&times;</span>
            </button>  
          </div>

          <div id="countryDetailsModalBody" class="modal-body container text-center">
            <div class="row">
              <div class="col-4"><b>Populacija</b><p id="populationModal"></p></div>
              <div class="col-4"><b>Zastava</b><br><img height="24px" id="countryFlag"></img></div>
              <div class="col-4"><b>Glavno mesto</b><p id="countryCapitals"></p></div>
 
              <div class="w-100"></div>

              <div class="col-4"><b>Okuženi</b><p id="infectedModal"></p></div>
              <div class="col-4"><b>Danes okuženi</b><p id="infectedTodayModal"></p></div>
              <div class="col-4"><b>Obolevnost</b><p id="infectedRatioModal"></p></div>

              <div class="w-100"></div>

              <div class="col-4"><b>Umrli</b><p id="deadModal"></p></div>
              <div class="col-4"><b>Danes umrli</b><p id="deadTodayModal"></p></div>
              <div class="col-4"><b>Umrljivost</b><p id="deadRatioModal"></p></div>

              <div class="w-100"></div>

              <div class="col-4"><b>Ozdraveli</b><p id="curedModal"></p></div>
              <div class="col-4"><b>Odprti primeri</b><p id="activeModal"></p></div>
              <div class="col-4"><b>Kritični primeri</b><p id="criticalModal"></p></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="page-footer elegant-color text-center" id="footerDiv">
    <div class="container">
      <div class="row">
        <div class="col text-center">
          <h1><img src="/static/images/beer_emoji.png" class="img-fluid" alt="pivicka">&nbsp Pivička - Koronavirus po svetu v številkah.</h1>
        </div>
      </div>
    </div>
    <!-- Copyright -->
    <div class="footer-copyright elegant-color font-small text-center py-3">
      Zadnja posodobitev: {{ data_time }}
      <br>
      Vir: <a href="https://github.com/javieraviles/covidAPI">github.com/javieraviles/covidAPI</a>
    </div>
    <!-- Copyright -->
  </footer>
  <!-- Footer -->


  <!-- SCRIPTS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.1.0/tablesort.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.1.0/sorts/tablesort.number.min.js"></script>
  
  <!-- JQuery -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <!-- Bootstrap tooltips -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
  <!-- Bootstrap core JavaScript -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js"></script>
  <!-- MDB core JavaScript -->
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.14.1/js/mdb.min.js"></script>
  <!-- MDBootstrap Datatables  -->
  <script type="text/javascript" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>

  <script src="https://unpkg.com/sticky-table-headers"></script>
  <script src="{{ url_for('static', filename='app.js') }}"></script>

  <script>

    var country = "";
    $.getJSON('https://json.geoiplookup.io', function(data) {
    })
    .done(function(data) {
      country = data.country_name
      colorCountry(country);
    })

    // Search
    $("#search").on("keyup", function() {
      var value = $(this).val().toLowerCase();
      $("#dataTable tbody tr").filter(function() {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
      stripeTable()
      colorCountry(country)
    });

    $("tr").click(stripeTable());

    themeSetter();
    function themeSetter() {
      var today = new Date();
      var h = today.getHours();
      if (h > 20 || h < 7) {
        $("#dataTable").toggleClass("table-dark elegant-color-dark");
        $(".modal-content").toggleClass("elegant-color");
        $(".modal-body").toggleClass("text-white");
      }
    }

    function stripeTable() {
      /*
      var i = 0;
      $("#dataTable tbody tr").each(function (index) {
        $(this).css("background-color", "inherit");
        if($(this).css("display") != "none") {
          if ( i % 2 == 0) {
            $(this).css("background-color", "#f3f3f3");
          }
          i++;
        }
      })
      */
    };

    var coronaData = JSON.parse({{corona_data | tojson | safe}});
    var countries = {{ countries | tojson | safe }};
    var countriesTranslated = {{ countriesTranslated | tojson | safe }};
    var countriesFlags = {{ countriesFlags | tojson | safe }};
    var countriesCapitals = {{ countriesCapitals | tojson | safe }};
    var population = {{ population | tojson | safe }};
    var infected = {{ infected | tojson | safe }};
    var infectedToday = {{ infectedToday | tojson | safe }};
    var dead = {{ dead | tojson | safe }};
    var deadToday = {{ deadToday | tojson | safe }};
    var cured = {{ cured | tojson | safe }};
    var active = {{ active | tojson | safe }};
    var critical = {{ critical | tojson | safe }};
    var infectedRatio = {{ infectedRatio | tojson | safe }};
    var deadRatio = {{ deadRatio | tojson | safe }};
    var populationDeadShare = {{ populationDeadShare | tojson | safe }};
    var populationCuredShare = {{ populationCuredShare | tojson | safe }};
    var populationHealthyShare = {{ populationHealthyShare | tojson | safe }};
    var goodResponse = "{{ goodResponse }}"

    function tableCreate() {
      var headers = ["Država", "Populacija", "Okuženi", "Danes", "Obolevnost", "Umrli", "Umrljivost", "Ozdraveli"];
      var headersIcons = ["fas fa-flag", "", "fas fa-biohazard", "fas fa-calendar-day", "", "fas fa-book-dead", "", "fas fa-smile",];
      var tbl = document.getElementById('dataTable');
      var tbdy = document.createElement('tbody');
      var thdr = tbl.createTHead();
      thdr.setAttribute("class", "elegant-color white-text");
      var row = thdr.insertRow();
      for (var i = 0; i < headers.length; i++) {
        var cell = document.createElement("th");
        cell.setAttribute("style", "border:none !important; cursor: pointer;");
        cell.setAttribute("class", "col")
        cell.innerHTML = '<div class="d-none d-sm-block">' + headers[i] + '</div><div class="d-sm-none"><i class="' + headersIcons[i] + '"></i></div>'
        if (i == 2) {
          cell.setAttribute("data-sort-default", "")
        }
        if (i != 0) {
          cell.setAttribute("class", "text-right");
        }
        else {
          cell.innerHTML = headers[i];
        }
        if (i == 1 || i == 4 || i == 6 || i == 7) {
          cell.setAttribute("class", "d-none d-lg-table-cell text-right");
        }
        if (i == 4 || i == 7) {
          cell.setAttribute("class", "d-none d-sm-block d-lg-table-cell text-right");
        }
        row.appendChild(cell);
      }
      for (var i = 0; i < countries.length; i++) {
        var row = tbdy.insertRow();
        var cell = row.insertCell();
        row.setAttribute("class", "countryExpand");
        row.setAttribute("id", i);
        row.setAttribute("style", "cursor: pointer;")
        cell.innerHTML = countriesTranslated[i]
        cell.setAttribute("id", countries[i])
        cell = row.insertCell();
        cell.setAttribute("align", "right");
        cell.setAttribute("class", "d-none d-lg-table-cell text-right");
        cell.innerHTML = population[i];
        cell = row.insertCell();
        cell.setAttribute("align", "right");
        cell.innerHTML = infected[i];
        cell = row.insertCell();
        cell.setAttribute("align", "right");
        cell.innerHTML = infectedToday[i];
        cell = row.insertCell();
        cell.setAttribute("align", "right");
        cell.setAttribute("class", "d-none d-sm-block d-lg-table-cell text-right");
        cell.innerHTML = infectedRatio[i] + "%";
        cell = row.insertCell();
        cell.setAttribute("align", "right");
        cell.innerHTML = dead[i];
        cell = row.insertCell();
        cell.setAttribute("align", "right");
        cell.setAttribute("class", "d-none d-lg-table-cell text-right");
        cell.innerHTML = deadRatio[i] + "%";
        cell = row.insertCell();
        cell.setAttribute("align", "right");
        cell.setAttribute("class", "d-none d-sm-block d-lg-table-cell text-right");
        cell.innerHTML = cured[i];
      }
      tbl.appendChild(tbdy);
    }

    if(goodResponse == "True") {
      tableCreate();  
    }
    else {
      var mainDiv = document.getElementById("mainDiv");
      mainDiv.innerHTML = '<div class="text-center" style="margin-top: 50px !important;"><h1>Dostop do podatkov trenutno ni mogoč! 😟</h1><p class="lead">Uporabite alternativne spletne aplikacije za pregled podatkov.<br>👉 <a href="https://www.arcgis.com/apps/opsdashboard/index.html#/bda7594740fd40299423467b48e9ecf6">COVID-19 Tracker by CSSE</a></p></div>';
      var footerDiv = document.getElementById("footerDiv")
      footerDiv.setAttribute("style", "position: fixed; bottom: 0; width: 100%;")
    }
    
    // Zaženemo plugin za sortiranje
    new Tablesort(document.getElementById("dataTable"), {
      descending: true
    });
    
    // Zaženemo plugin za stickanje headerjev
    $('table').stickyTableHeaders();
        
    function colorCountry(country) {
      var table = $("#dataTable");
      var tbody = table.find("tbody");
      var rows = tbody.find("tr");
      for (var i=0; i<rows.length; i++) {
        var cells = rows[i].getElementsByTagName("td")
        var countryRegex = new RegExp("^" + country + ".*$");
        if(countryRegex.test(cells[0].getAttribute("id"))) {
          rows[i].style.backgroundColor = "#ffbb33";
          rows[i].style.color = "white";
        }
      }
    };

    $(".countryExpand").click(function() {
      var i = $(this).attr("id");
      $("#countryDetailsModalTitle").text(countriesTranslated[i]);
      $("#populationModal").text(population[i]);
      $("#infectedModal").text(infected[i]);
      $("#infectedTodayModal").text(infectedToday[i]);
      $("#infectedRatioModal").text(infectedRatio[i] + "%");
      $("#deadModal").text(dead[i]);
      $("#deadTodayModal").text(deadToday[i]);
      $("#deadRatioModal").text(deadRatio[i] + "%");
      $("#curedModal").text(cured[i]);
      $("#activeModal").text(active[i]);
      $("#criticalModal").text(critical[i]);
      $("#countryFlag").attr("src", countriesFlags[i])
      $("#countryCapitals").text(countriesCapitals[i])
      $("#countryDetailsModal").modal("show");
    });
    
  </script>

</body>

</html>